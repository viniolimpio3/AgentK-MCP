services:
  # Servidor MCP AgentK
  agentk-server:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: agentk-mcp-server
    ports:
      - "3333:3333"
    environment:
      - PYTHONUNBUFFERED=1
      - FASTMCP_HOST=0.0.0.0
      - FASTMCP_PORT=3333
      - FASTMCP_LOG_LEVEL=INFO
      - STREAMLIT_SERVER_HEADLESS=true
      - STREAMLIT_SERVER_ENABLE_CORS=false
      - KUBECONFIG=/home/ubuntu/.kube/config
    volumes:
      #- ~/.kube/:/app/.kube/:ro
      #- ~/.minikube:/app/.minikube:ro
      - /home/ubuntu:/home/ubuntu:ro
    networks:
      - agentk-network
      - minikube
    restart: unless-stopped

  # Cliente Streamlit AgentK
  agentk-client:
    build:
      context: ./client
      dockerfile: Dockerfile
    container_name: agentk-streamlit-client
    ports:
      - "8501:8501"
    environment:
      - PYTHONUNBUFFERED=1
      # Variável para conectar ao servidor MCP via HTTP
      - MCP_SERVER_URL=${MCP_SERVER_URL}
      # Chave da OpenAI (deve ser definida via .env ou variável de ambiente)
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    networks:
      - agentk-network
    depends_on:
      agentk-server:
        condition: service_healthy
    restart: unless-stopped

networks:
  agentk-network:
    driver: bridge
    name: agentk-network
  minikube:
    external: true
    name: minikube

volumes:
  agentk-logs:
    driver: local